<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - FerreMax</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/636360e29b.js" crossorigin="anonymous"></script>

    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- DataTable -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css"/>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>

    <!-- Estilos personalizados -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body>
<!-- Overlay para mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Incluir el fragmento del sidebar pasando el parámetro currentPage -->
<div th:replace="~{fragments/sidebar :: sidebar(currentPage='reportes')}"></div>

<!-- Contenido Principal -->
<div class="main-content">
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid px-4">
            <div class="d-flex justify-content-between align-items-center w-100">
                <button class="sidebar-toggle d-lg-none" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="flex-grow-1"></div>
                <div class="d-flex align-items-center gap-3">
                    <div class="position-relative">
                        <button class="btn btn-link text-secondary p-2">
                            <i class="fas fa-bell fs-5"></i>
                            <span class="notification-badge"></span>
                        </button>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div class="d-flex align-items-center justify-content-center bg-primary rounded-circle" style="width: 35px; height: 35px;">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div class="d-none d-md-block">
                            <div class="fw-bold text-dark" style="font-size: 0.9rem;">Juan Administrador</div>
                            <div class="text-muted" style="font-size: 0.8rem;">Gerente General</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Content Header -->
    <div class="content-header py-4 px-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
            <div>
                <h2 class="mb-1 fw-bold text-custom-primary">Reportes y Análisis</h2>
                <p class="text-muted mb-0">Visualiza el rendimiento de tu ferretería</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary">
                    <i class="fas fa-download me-2"></i>
                    Exportar PDF
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-calendar me-2"></i>
                    Filtrar Período
                </button>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filter-section py-3 px-4">
        <div class="row g-3">
            <div class="col-12 col-md-3">
                <select class="form-select">
                    <option selected>Este mes</option>
                    <option>Último mes</option>
                    <option>Últimos 3 meses</option>
                    <option>Este año</option>
                    <option>Personalizado</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <select class="form-select">
                    <option selected>Todas las categorías</option>
                    <option>Herramientas</option>
                    <option>Pinturas</option>
                    <option>Tornillería</option>
                    <option>Eléctricos</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <select class="form-select">
                    <option selected>Todos los empleados</option>
                    <option>Juan Pérez</option>
                    <option>María García</option>
                    <option>Carlos López</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <button class="btn btn-outline-primary w-100">
                    <i class="fas fa-search me-2"></i>
                    Aplicar Filtros
                </button>
            </div>
        </div>
    </div>

    <!-- Contenido de Reportes -->
    <div class="container-fluid p-4">
        <!-- Métricas principales del período -->
        <div class="row g-4 mb-4">
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card card-custom stats-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon me-3" style="background: rgba(91, 190, 131, 0.1);">
                                <i class="fas fa-chart-line" style="color: var(--success-color);"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h3 class="mb-1 fw-bold">$45.280.000</h3>
                                <p class="text-custom-secondary mb-0 small">Ventas del Mes</p>
                                <span class="badge bg-success bg-opacity-10 text-success small">
                                    <i class="fas fa-arrow-up me-1"></i>+18% vs mes anterior
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card card-custom stats-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon me-3" style="background: rgba(249, 115, 22, 0.1);">
                                <i class="fas fa-receipt" style="color: var(--accent-color);"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h3 class="mb-1 fw-bold">847</h3>
                                <p class="text-custom-secondary mb-0 small">Transacciones</p>
                                <span class="badge bg-primary bg-opacity-10 text-primary small">
                                    <i class="fas fa-equals me-1"></i>$53.456 promedio
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card card-custom stats-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon me-3" style="background: rgba(59, 130, 246, 0.1);">
                                <i class="fas fa-percentage" style="color: #3B82F6;"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h3 class="mb-1 fw-bold">32%</h3>
                                <p class="text-custom-secondary mb-0 small">Margen de Ganancia</p>
                                <span class="badge bg-info bg-opacity-10 text-info small">
                                    <i class="fas fa-arrow-up me-1"></i>+2% vs mes anterior
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card card-custom stats-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="stats-icon me-3" style="background: rgba(139, 92, 246, 0.1);">
                                <i class="fas fa-arrow-trend-up" style="color: #8B5CF6;"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h3 class="mb-1 fw-bold">156</h3>
                                <p class="text-custom-secondary mb-0 small">Nuevos Clientes</p>
                                <span class="badge bg-warning bg-opacity-10 text-warning small">
                                    <i class="fas fa-clock me-1"></i>23% recurrentes
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráficos principales -->
        <div class="row g-4 mb-4">
            <!-- Gráfico de ventas mensuales -->
            <div class="col-12 col-lg-8">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Evolución de Ventas</h5>
                        <p class="text-custom-secondary small mb-0">Comparación mensual de los últimos 6 meses</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="chart-container">
                            <canvas id="monthlyRevenueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top productos -->
            <div class="col-12 col-lg-4">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Productos Estrella</h5>
                        <p class="text-custom-secondary small mb-0">Mayores ingresos del mes</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="d-flex align-items-center mb-3 p-3 rounded" style="background: var(--bg-card);">
                            <div class="me-3">
                                <div class="bg-success bg-opacity-10 p-2 rounded">
                                    <i class="fas fa-wrench text-success"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">Taladro Profesional</h6>
                                <small class="text-custom-secondary">28 unidades</small>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold text-success">$2.240.000</div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center mb-3 p-3 rounded" style="background: var(--bg-card);">
                            <div class="me-3">
                                <div class="bg-primary bg-opacity-10 p-2 rounded">
                                    <i class="fas fa-paint-brush text-primary"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">Pintura Premium 4L</h6>
                                <small class="text-custom-secondary">156 galones</small>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold text-success">$1.872.000</div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center mb-3 p-3 rounded" style="background: var(--bg-card);">
                            <div class="me-3">
                                <div class="bg-warning bg-opacity-10 p-2 rounded">
                                    <i class="fas fa-screwdriver text-warning"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">Kit Herramientas</h6>
                                <small class="text-custom-secondary">45 kits</small>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold text-success">$1.575.000</div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center p-3 rounded" style="background: var(--bg-card);">
                            <div class="me-3">
                                <div class="bg-info bg-opacity-10 p-2 rounded">
                                    <i class="fas fa-bolt text-info"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">Cable Eléctrico 12AWG</h6>
                                <small class="text-custom-secondary">230 metros</small>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold text-success">$1.265.000</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segunda fila de gráficos -->
        <div class="row g-4 mb-4">
            <!-- Ventas por categoría -->
            <div class="col-12 col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Ventas por Categoría</h5>
                        <p class="text-custom-secondary small mb-0">Distribución de ingresos por tipo de producto</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rendimiento de empleados -->
            <div class="col-12 col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Rendimiento por Empleado</h5>
                        <p class="text-custom-secondary small mb-0">Ventas realizadas este mes</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="chart-container">
                            <canvas id="employeeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de transacciones recientes -->
        <div class="row g-4 mb-4">
            <div class="col-12">
                <div class="card card-custom">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Transacciones Recientes</h5>
                        <p class="text-custom-secondary small mb-0">Últimas 50 ventas registradas</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="table-responsive">
                            <table id="transactionsTable" class="table inventory-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-3">Fecha</th>
                                        <th class="py-3 px-3">Cliente</th>
                                        <th class="py-3 px-3">Empleado</th>
                                        <th class="py-3 px-3">Productos</th>
                                        <th class="py-3 px-3">Total</th>
                                        <th class="py-3 px-3">Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="py-3 px-3">12/08/2025 14:30</td>
                                        <td class="py-3 px-3">María González</td>
                                        <td class="py-3 px-3">Juan Pérez</td>
                                        <td class="py-3 px-3">Martillo, Clavos</td>
                                        <td class="py-3 px-3 fw-bold text-success">$85.000</td>
                                        <td class="py-3 px-3"><span class="status-available">Completada</span></td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 px-3">12/08/2025 13:15</td>
                                        <td class="py-3 px-3">Carlos Mendoza</td>
                                        <td class="py-3 px-3">María García</td>
                                        <td class="py-3 px-3">Pintura, Rodillo</td>
                                        <td class="py-3 px-3 fw-bold text-success">$127.500</td>
                                        <td class="py-3 px-3"><span class="status-available">Completada</span></td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 px-3">12/08/2025 12:45</td>
                                        <td class="py-3 px-3">Ana Rodríguez</td>
                                        <td class="py-3 px-3">Carlos López</td>
                                        <td class="py-3 px-3">Destornilladores</td>
                                        <td class="py-3 px-3 fw-bold text-success">$45.000</td>
                                        <td class="py-3 px-3"><span class="status-available">Completada</span></td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 px-3">12/08/2025 11:30</td>
                                        <td class="py-3 px-3">Roberto Silva</td>
                                        <td class="py-3 px-3">Juan Pérez</td>
                                        <td class="py-3 px-3">Taladro, Brocas</td>
                                        <td class="py-3 px-3 fw-bold text-success">$235.000</td>
                                        <td class="py-3 px-3"><span class="status-available">Completada</span></td>
                                    </tr>
                                    <tr>
                                        <td class="py-3 px-3">12/08/2025 10:15</td>
                                        <td class="py-3 px-3">Luisa Herrera</td>
                                        <td class="py-3 px-3">María García</td>
                                        <td class="py-3 px-3">Tornillos, Tuercas</td>
                                        <td class="py-3 px-3 fw-bold text-success">$32.000</td>
                                        <td class="py-3 px-3"><span class="status-available">Completada</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen y análisis -->
        <div class="row g-4">
            <div class="col-12 col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Análisis de Tendencias</h5>
                        <p class="text-custom-secondary small mb-0">Insights del comportamiento de ventas</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-trend-up text-success"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Crecimiento sostenido</h6>
                                    <p class="text-custom-secondary small mb-0">Las ventas han aumentado 18% comparado con el mes anterior</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-star text-warning"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Productos estrella</h6>
                                    <p class="text-custom-secondary small mb-0">Herramientas eléctricas representan el 40% de los ingresos</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-users text-primary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Base de clientes</h6>
                                    <p class="text-custom-secondary small mb-0">156 nuevos clientes adquiridos este mes</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-clock text-info"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Horarios pico</h6>
                                    <p class="text-custom-secondary small mb-0">Mayor actividad entre 2-5 PM y fines de semana</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-header bg-transparent border-0 pt-4 px-4">
                        <h5 class="card-title text-custom-primary mb-0">Recomendaciones</h5>
                        <p class="text-custom-secondary small mb-0">Acciones sugeridas para mejorar rendimiento</p>
                    </div>
                    <div class="card-body pt-2">
                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-lightbulb text-warning"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Ampliar stock</h6>
                                    <p class="text-custom-secondary small mb-0">Incrementar inventario de herramientas eléctricas debido a alta demanda</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-percentage text-success"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Promociones dirigidas</h6>
                                    <p class="text-custom-secondary small mb-0">Crear ofertas especiales para productos de menor rotación</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-medal text-primary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Reconocer desempeño</h6>
                                    <p class="text-custom-secondary small mb-0">Juan Pérez lidera en ventas este mes con $8.2M</p>
                                </div>
                            </div>
                        </div>

                        <div class="activity-item ps-3 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <i class="fas fa-chart-line text-info"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Optimizar horarios</h6>
                                    <p class="text-custom-secondary small mb-0">Ajustar turnos para cubrir mejor las horas pico de ventas</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript para gráficos -->
<script>
// Gráfico de evolución de ventas mensuales
const monthlyCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'line',
    data: {
        labels: ['Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago'],
        datasets: [{
            label: 'Ventas 2025',
            data: [28000000, 32000000, 35000000, 38000000, 42000000, 45280000],
            borderColor: '#F97316',
            backgroundColor: 'rgba(249, 115, 22, 0.1)',
            tension: 0.4,
            fill: true
        }, {
            label: 'Ventas 2024',
            data: [25000000, 27000000, 29000000, 31000000, 33000000, 38500000],
            borderColor: '#CBD5E1',
            backgroundColor: 'transparent',
            tension: 0.4,
            fill: false
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '$' + (value / 1000000).toFixed(0) + 'M';
                    }
                }
            }
        }
    }
});

// Gráfico de ventas por categoría
const categoryCtx = document.getElementById('categoryChart').getContext('2d');
new Chart(categoryCtx, {
    type: 'doughnut',
    data: {
        labels: ['Herramientas Eléctricas', 'Pinturas', 'Tornillería', 'Plomería', 'Ferretería General'],
        datasets: [{
            data: [40, 25, 15, 12, 8],
            backgroundColor: [
                '#F97316',
                '#5BBE83',
                '#F9AA33',
                '#3B82F6',
                '#8B5CF6'
            ],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
            }
        }
    }
});

// Gráfico de rendimiento de empleados
const employeeCtx = document.getElementById('employeeChart').getContext('2d');
new Chart(employeeCtx, {
    type: 'bar',
    data: {
        labels: ['Juan Pérez', 'María García', 'Carlos López', 'Ana Rodríguez', 'Luis Martín'],
        datasets: [{
            label: 'Ventas (Millones)',
            data: [8.2, 6.8, 5.9, 4.3, 3.1],
            backgroundColor: [
                '#F97316',
                '#5BBE83',
                '#F9AA33',
                '#3B82F6',
                '#8B5CF6'
            ],
            borderRadius: 4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return ' + value + 'M';
                    }
                }
            }
        }
    }
});
</script>

<!-- JavaScript global -->
<script th:src="@{/js/script.js}"></script>
</body>
</html>